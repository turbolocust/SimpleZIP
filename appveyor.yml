version: '{build}'
branches:
  only:
  - master
skip_tags: true
skip_commits:
  files:
    - SimpleZIP_UI/Assets/*
    - .gitattributes
    - .gitignore
    - LICENSE.md
    - README.md
image: Visual Studio 2017
environment:
  secret_storeKey:
    secure: iGyhcOxgR6HeJ2sNLrgqSdF5u0ux+m2K+fb4pWF8xgE=
  secret_storeAssociation:
    secure: xjfRZSCdwPQ+BEUp5WI8umiNB9VdpPSQ6H5HvFpvEPI=
install:
- ps: >-
    nuget install secure-file -ExcludeVersion

    secure-file\tools\secure-file -decrypt SimpleZIP_UI\SimpleZIP_UI_StoreKey.pfx.enc -secret %secret_storeKey%

    secure-file\tools\secure-file -decrypt SimpleZIP_UI\Package.StoreAssociation.xml.enc -secret %secret_storeAssociation%
build_script:
- ps: >-
    Write-Host "Downloading latest Nuget executable..."

    appveyor DownloadFile https://dist.nuget.org/win-x86-commandline/latest/nuget.exe

    Write-Host "Downloaded" -ForegroundColor green

    Write-Host "Performing Nuget restore..."

    appveyor-retry nuget restore

    Write-Host "Restore complete" -ForegroundColor green


    Write-Host "Downloading Microsoft Store Services SDK from private mirror..."

    $msiPath = "$($env:USERPROFILE)\MicrosoftStoreServicesSDK.msi"

    (New-Object Net.WebClient).DownloadFile('https://homepages.fhv.at/mfu7609/mirror/MicrosoftStoreServicesSDK.msi', $msiPath)

    Write-Host "Installing Microsoft Store Services SDK..."

    cmd /c start /wait msiexec /i $msiPath /quiet

    Write-Host "Installed" -ForegroundColor green


    Write-Host "Starting to build using MSBuild..."

    msbuild "C:\projects\simplezip\SimpleZIP_UI.sln" /t:Build /p:Configuration=Release /p:Platform=x86 /p:AppxPackage=false /verbosity:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"
